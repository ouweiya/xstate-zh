---
title: 'XState v5 å‘å¸ƒäº†'
description: 'ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´ç»ˆäºå‘å¸ƒäº† XState v5ï¼è¿™æ˜¯ XState çš„ä¸€ä¸ªæ–°ä¸»è¦ç‰ˆæœ¬ï¼Œä¸“æ³¨äº actorsï¼Œå¹¶å¸®åŠ©æ‚¨æ¯”ä»¥å‰çš„ç‰ˆæœ¬æ›´å¿«ã€æ›´è½»æ¾åœ°å¼€å§‹ä½¿ç”¨ XStateã€‚'
authors: [david]
tags: [xstate, stately, state machines, actor model]
date: 2023-12-01
slug: 2023-12-01-xstate-v5
image: /blog/2023-12-01-xstate-v5.png
---

# XState v5 å‘å¸ƒäº†

ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´ç»ˆäºå‘å¸ƒäº† XState v5ï¼è¿™æ˜¯ XState çš„ä¸€ä¸ªæ–°ä¸»è¦ç‰ˆæœ¬ï¼Œä¸“æ³¨äº actorsï¼Œå¹¶å¸®åŠ©æ‚¨æ¯”ä»¥å‰çš„ç‰ˆæœ¬æ›´å¿«ã€æ›´è½»æ¾åœ°å¼€å§‹ä½¿ç”¨ XStateã€‚

çŠ¶æ€æœºè½¬æ¢å¯èƒ½éœ€è¦é›¶æ—¶é—´ï¼Œä½†ä» XState v4 è¿‡æ¸¡åˆ° v5 èŠ±äº†å¾ˆé•¿æ—¶é—´ã€‚æˆ‘ä»¬åœ¨ 2018 å¹´ 10 æœˆå‘å¸ƒäº† XState v4ï¼Œå¹¶åœ¨æ­¤åçš„å¤§éƒ¨åˆ†æ—¶é—´é‡Œä¸€ç›´è‡´åŠ›äºä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬çš„å¼€å‘ã€‚å‡­å€Ÿ GitHub ä¸Šè¶…è¿‡ 25k é¢—æ˜Ÿã€npm ä¸Šæ¯å‘¨ 100 ä¸‡æ¬¡ä¸‹è½½ä»¥åŠä¸€ä¸ªäº†ä¸èµ·çš„ç¤¾åŒºï¼Œæˆ‘ä»¬èƒ½å¤Ÿå€¾å¬å’Œå­¦ä¹ é‚£äº›åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ XState çš„äººï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ›´å¼ºå¤§ä½†æ›´ç®€å•ï¼ˆä¸”æ›´å°ï¼ï¼‰çš„ç‰ˆæœ¬ã€‚

{/* truncate */}

æé†’ä¸€ä¸‹ï¼ŒXState æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºï¼ˆMIT è®¸å¯ï¼‰ã€é›¶ä¾èµ–çš„çŠ¶æ€ç®¡ç†å’Œç¼–æ’è§£å†³æ–¹æ¡ˆï¼ŒåŸºäºçŠ¶æ€æœºã€çŠ¶æ€å›¾å’Œ actor æ¨¡å‹ã€‚**XState ç¼–æ’ä»»ä½•é€»è¾‘**ï¼Œä» promises åˆ°çŠ¶æ€æœºä»¥åŠå…¶ä»–æ‰€æœ‰å†…å®¹ã€‚å®ƒæœ€é€‚åˆç®¡ç†å’Œç¼–æ’è¶…è¶Šç®€å•çŠ¶æ€ç®¡ç†çš„å¤æ‚åº”ç”¨é€»è¾‘ï¼Œå¹¶ä½¿åº”ç”¨é€»è¾‘åœ¨è§†è§‰ä¸Šå…·æœ‰åä½œæ€§ï¼Œä»¥ä¾¿æ‚¨çš„æ•´ä¸ªå›¢é˜Ÿï¼ˆæŠ€æœ¯å’ŒéæŠ€æœ¯äººå‘˜ï¼‰éƒ½èƒ½è½»æ¾ç†è§£å’Œè´¡çŒ®ã€‚

æ‚¨å¯ä»¥é€šè¿‡å®‰è£… `xstate` æ¥ç«‹å³è¯•ç”¨ XState v5ï¼š

```bash
npm i xstate
```

## æˆ‘ä»¬å¯¹ XState v5 çš„æ„¿æ™¯

åœ¨ XState v4 ä¸­ï¼Œ**çŠ¶æ€æœºå’ŒçŠ¶æ€å›¾æ˜¯ä¸»è¦ç„¦ç‚¹**ã€‚é€šè¿‡çŠ¶æ€æœºä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼å»ºæ¨¡å¤æ‚é€»è¾‘è¢«è¯æ˜æ˜¯è®¸å¤šåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ XState çš„å…¬å¸çš„ä¸€ç§å¯é ç­–ç•¥ã€‚æˆ‘ä»¬äº†è§£åˆ°ï¼ŒXState ä¸ä»…å¯¹ç®¡ç†å‰ç«¯é€»è¾‘ï¼ˆå¦‚å¤æ‚ç»„ä»¶æˆ–å¤šæ­¥éª¤è¡¨å•ï¼‰æœ‰ç”¨ï¼Œå›¢é˜Ÿè¿˜ä½¿ç”¨å®ƒæ¥ç®¡ç†åç«¯å·¥ä½œæµå’Œå…³é”®ä¸šåŠ¡é€»è¾‘ã€‚

ä½†éšç€ç”¨ä¾‹çš„å¢åŠ ï¼Œå¾ˆæ˜æ˜¾ XState éœ€è¦ä»ç®¡ç†ç³»ç»ŸæŸä¸€éƒ¨åˆ†çš„é€»è¾‘å‘å±•åˆ°åè°ƒéœ€è¦ç›¸äº’é€šä¿¡çš„å¤šä¸ªéƒ¨åˆ†çš„é€»è¾‘ã€‚XState æœ€åˆæœ‰ **æ´»åŠ¨**ï¼Œåæ¥è¢« **è°ƒç”¨çš„ actors**ï¼ˆåœ¨ v4 ä¸­ç§°ä¸ºâ€œæœåŠ¡â€ï¼‰å–ä»£ã€‚çŠ¶æ€æœºå’Œ actor æ¨¡å‹è‡ªç„¶åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºçŠ¶æ€æœºå¯ä»¥å»ºæ¨¡å•ä¸ª actor çš„è¡Œä¸ºï¼Œè€Œ actor æ¨¡å‹å¯ä»¥å»ºæ¨¡å¤šä¸ªç›¸äº’é€šä¿¡çš„ actor çš„è¡Œä¸ºã€‚

æ‰€ä»¥ç°åœ¨ï¼Œåœ¨ XState v5 ä¸­ï¼Œ**actors æ˜¯ä¸»è¦ç„¦ç‚¹**ã€‚çŠ¶æ€æœºå’ŒçŠ¶æ€å›¾ä»ç„¶æ˜¯ XState çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯å»ºæ¨¡ actor è¡Œä¸ºçš„å”¯ä¸€æ–¹å¼ï¼ˆå°½ç®¡å®ƒä»¬å¯ä»¥è¯´æ˜¯æœ€å¼ºå¤§çš„æ–¹å¼ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ› XState æˆä¸ºä¸€ä¸ªå¤šåŠŸèƒ½çš„çŠ¶æ€åè°ƒåº“ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ [actor æ¨¡å‹](/blog/what-is-the-actor-model)ï¼Œæ— è®ºä»–ä»¬é€‰æ‹©å¦‚ä½•ç¼–å†™é€»è¾‘ã€‚æ— è®ºæ‚¨æ˜¯ä½¿ç”¨ promises ç¼–å†™å¼‚æ­¥é€»è¾‘ï¼Œä½¿ç”¨ observablesï¼Œä½¿ç”¨ reducers ç®¡ç†çŠ¶æ€ï¼Œè¿˜æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°å¤„ç†ä»»ä½•å…¶ä»–ç±»å‹çš„é€»è¾‘ï¼Œæ‚¨éƒ½å¯ä»¥ä½¿ç”¨ XState ä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼åè°ƒæ‚¨çš„çŠ¶æ€ã€‚

è¯è™½å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜ï¼š

- å¤§å¤§ç®€åŒ–äº† API å¹¶å‡å°‘äº†è¡¨é¢ç§¯
- å¼•å…¥äº†æ–°çš„çŠ¶æ€æœºåŠŸèƒ½ï¼Œä½¿å¼ºå¤§çš„æ¨¡å¼æˆä¸ºå¯èƒ½
- å¤§å¹…æ”¹å–„äº† TypeScript å¼€å‘è€…ä½“éªŒï¼Œæä¾›äº†æ›´å¥½çš„æ¨æ–­
- å¤§å¹…å‡å°‘äº†åŒ…çš„å¤§å°
- æ”¹è¿›äº†æ–‡æ¡£å¹¶æ·»åŠ äº†è®¸å¤šæ–°ç¤ºä¾‹

è¿™ä¸ªç‰ˆæœ¬æœ‰å¾ˆå¤šæ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘æœ€å–œæ¬¢çš„ä¸€äº›æ–°åŠŸèƒ½ã€‚

## ä¸€åˆ‡éƒ½æ˜¯ actor

åœ¨ XState v5 ä¸­ï¼Œ**Actor** æ˜¯ä¸»è¦çš„æŠ½è±¡å•ä½ã€‚actors æ¯”ä½ æƒ³è±¡çš„è¦ç®€å•ï¼›å®ƒä»¬æ˜¯ä¸€äº›å¯¹è±¡ï¼š

- æœ‰è‡ªå·±çš„å†…éƒ¨çŠ¶æ€
- å¯ä»¥å‘é€å’Œæ¥æ”¶äº‹ä»¶ï¼ˆæˆ–â€œæ¶ˆæ¯â€ï¼‰å¹¶å¯¹å…¶åšå‡ºååº”
- å¯ä»¥åˆ›å»ºå…¶ä»– actors

å¦‚æœä½ ä½¿ç”¨è¿‡ Redux æˆ– Zustand ç­‰åº“ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™å¬èµ·æ¥æœ‰ç‚¹åƒâ€œstoreâ€ã€‚ä½ æ˜¯å¯¹çš„ï¼å°±åƒ store æœ‰è‡ªå·±çš„å†…éƒ¨çŠ¶æ€å¹¶ä¸”åœ¨æ¥æ”¶åˆ°äº‹ä»¶æ—¶å¯ä»¥æ”¹å˜å…¶çŠ¶æ€ä¸€æ ·ï¼Œactors ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ç”šè‡³æ›´å¤šã€‚

åœ¨ XState v5 ä¸­ï¼Œæœ‰å‡ ä¸ª [æ–°çš„ actor é€»è¾‘åˆ›å»ºå™¨](/docs/actors/#actor-logic-creators) ç”¨äºåˆ›å»ºï¼š

**Promise actor logic**

```jsx
import { fromPromise } from 'xstate';

const promiseLogic = fromPromise(async ({ input }) => {
  const user = await getUser(input.userId);

  return user;
});
```

**Transition function actor logic**

```jsx
import { fromTransition } from 'xstate';

const transitionLogic = fromTransition((state, event) => {
  switch (event.type) {
    // reducer logic; you know the drill
  }
}, { count: 0 });
```

**Observable actor logic**

```jsx
import { fromObservable } from 'xstate';
import { interval } from 'rxjs';

const intervalLogic = fromObservable(() => interval(1000));
```

**Callback actor logic**

```jsx
import { fromCallback } from 'xstate';

const callbackLogic = fromCallback(({ sendBack, receive }) => {
  const handler = (event) => {
    sendBack(event);
  }

  window.addEventListener('message', handler);

  return () => { window.removeEventListener('message', handler); }
});
```

è¦ä»è¿™äº›é€»è¾‘åˆ›å»º actorsï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `createActor(logic)` å‡½æ•°ï¼ˆåœ¨ XState v4 ä¸­ç§°ä¸º `interpret()`ï¼‰ï¼š

```jsx
import { createActor } from 'xstate';

// ...

const actor = createActor(someLogic);

actor.subscribe(snapshot => {
  console.log(snapshot);
});

actor.start();

actor.send({ type: 'greet', greeting: 'hello world' });
```

æ— è®ºæ‚¨åˆ›å»ºå“ªç§é€»è¾‘ï¼Œåˆ›å»º actors çš„æ–¹å¼éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚actors æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æŠ½è±¡å•å…ƒï¼Œå› ä¸ºå®ƒä»¬ä¸ä»…ä»£è¡¨äº†å¤„ç†åº”ç”¨ç¨‹åºä¸­å‡ ä¹æ‰€æœ‰äº‹æƒ…çš„å•ä¸€æ¥å£ï¼Œè€Œä¸” actor ä¹‹é—´çš„é€šä¿¡ä¹Ÿå¯ä»¥åœ¨åºåˆ—å›¾ä¸­æ¸…æ™°åœ°å¯è§†åŒ–ï¼ˆæˆ‘ä»¬å°†å¾ˆå¿«å‘å¸ƒï¼‰ã€‚æ­¤å¤–ï¼Œè¿™ç§ç®€å•çš„æŠ½è±¡ä½¿æ‚¨èƒ½å¤Ÿåˆ›å»º**å¯ç»„åˆçš„ actor é€»è¾‘**ï¼š

```ts
function withLogging(actorLogic) {
  return {
    ...actorLogic,
    transition: (state, event, actorScope) => {
      console.log('State:', state);
      return actorLogic.transition(state, event, actorScope);
    }
  }
}

const actor = createActor(withLogging(someLogic));
```

æœ‰äº†è¿™äº›æ„å»ºå—ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ›´é«˜çº§çš„æŠ½è±¡ï¼Œä¾‹å¦‚ `withUndoRedo`ã€`withDebounce`ï¼Œç”šè‡³è‡ªå®šä¹‰ actor é€»è¾‘ï¼Œå¦‚ `fromGenerator`ã€`fromWebSocket` ç­‰ã€‚

## Inspect API

æœ‰ä¸€ç§æ–°çš„ã€æ›´ç®€æ´çš„æ–¹æ³•æ¥[æ£€æŸ¥](/docs/inspection)ä¸ä»…æ˜¯çŠ¶æ€æœºçš„çŠ¶æ€è½¬æ¢ï¼Œè¿˜æœ‰ actor ç³»ç»Ÿä¸­ actor çš„å„ä¸ªæ–¹é¢ï¼š

- Actor ç”Ÿå‘½å‘¨æœŸ
- Actor äº‹ä»¶é€šä¿¡
- Actor å¿«ç…§æ›´æ–°

ä¸å…¶ç¥å¥‡åœ°è®¾ç½® `devTools: true`ï¼Œä¸å¦‚ä½¿ç”¨ Inspect API å°†â€œæ£€æŸ¥å™¨â€ï¼ˆåªæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œè§‚å¯Ÿæ£€æŸ¥äº‹ä»¶ï¼‰é™„åŠ åˆ° actor ç³»ç»Ÿçš„æ ¹éƒ¨ï¼š

```jsx
const actor = createActor(machine, {
  inspect: (inspectionEvent) => {
    // type: '@xstate.actor' or
    // type: '@xstate.snapshot' or
    // type: '@xstate.event'
    console.log(inspectionEvent);
  }
});
```

æ£€æŸ¥å™¨å°†æ¥æ”¶ç³»ç»Ÿä¸­æ¯ä¸ª actor çš„æ£€æŸ¥äº‹ä»¶ï¼Œè®©æ‚¨å¯¹å‘ç”Ÿçš„ä¸€åˆ‡æœ‰ç»†ç²’åº¦çš„å¯è§æ€§ï¼Œä»å•ä¸ª actor å¦‚ä½•å˜åŒ–åˆ° actor ä¹‹é—´å¦‚ä½•ç›¸äº’é€šä¿¡ã€‚

æˆ‘ä»¬å°†å¾ˆå¿«å‘å¸ƒæ£€æŸ¥å¼€å‘å·¥å…·ï¼Œä»¥çŠ¶æ€æœºå›¾ã€åºåˆ—å›¾ç­‰å½¢å¼å¯è§†åŒ–è¿™äº›ä¿¡æ¯ã€‚

## æ·±åº¦æŒä¹…åŒ–

æˆ‘ä»¬å·²ç»å†™è¿‡[å¦‚ä½•æŒä¹…åŒ–çŠ¶æ€](/blog/2023-10-02-persisting-state)ï¼Œè€Œ XState v5 å°†æŒä¹…åŒ–è¿›ä¸€æ­¥æå‡ã€‚[Actor æŒä¹…åŒ–](/docs/persistence)æ˜¯ä¸€ç§æ¨¡å¼ï¼Œå…¶ä¸­ actor çš„å†…éƒ¨çŠ¶æ€å¯ä»¥éšæ—¶æŒä¹…åŒ–å’Œæ¢å¤ã€‚åœ¨ XState v4 ä¸­ï¼Œè¢«è°ƒç”¨/ç”Ÿæˆçš„ actor ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œè€Œåœ¨ XState v5 ä¸­ï¼Œ**actors ç°åœ¨è¢«æ·±åº¦ï¼ˆé€’å½’åœ°ï¼‰æŒä¹…åŒ–**ã€‚è¢«è°ƒç”¨/ç”Ÿæˆçš„ actors å°†è¢«æŒä¹…åŒ–ï¼Œä»¥åŠä»è¿™äº› actors è°ƒç”¨/ç”Ÿæˆçš„ actorsï¼Œä¾æ­¤ç±»æ¨ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ`mainActor` çš„çŠ¶æ€å°†è¢«æŒä¹…åŒ–ï¼Œä»¥åŠè¢«è°ƒç”¨çš„ `someCounter` actor çš„çŠ¶æ€ã€‚å½“ `restoredActor` å¯åŠ¨æ—¶ï¼Œå®ƒå°†ä» `mainActor` çš„æŒä¹…åŒ–çŠ¶æ€å¼€å§‹ï¼Œå…¶ä¸­åŒ…æ‹¬ `someCounter` çš„æŒä¹…åŒ–çŠ¶æ€ï¼š

```ts
import { setup, createActor } from 'xstate';

const machine = setup({
  actors: {
    counter: fromTransition(/* ... */)
  }
}).createMachine({
  invoke: {
    // è¿™ä¹Ÿå°†è¢«æŒä¹…åŒ–ï¼
    src: 'counter',
    id: 'someCounter',
  },
  // ...
});

const mainActor = createActor(machine);
mainActor.start();

// æ·±åº¦æŒä¹…åŒ–çŠ¶æ€
// ä¹ŸæŒä¹…åŒ–äº† "someCounter" actorï¼
const persistedState = mainActor.getPersistedSnapshot();

// æ¢å¤çŠ¶æ€
const restoredActor = createActor(machine, {
  snapshot: persistedState,
});

// ä»é€’å½’æŒä¹…åŒ–çš„çŠ¶æ€å¼€å§‹
restoredActor.start();
```

è¿™å¯¹äºå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚å¤„ç†é¡µé¢åˆ·æ–°ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆä¾‹å¦‚æŒä¹…åŒ–å·¥ä½œæµçŠ¶æ€ï¼‰ç”¨ä¾‹éƒ½å¾ˆæœ‰ç”¨ã€‚[åœ¨æˆ‘ä»¬çš„æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šå…³äº actor æŒä¹…åŒ–çš„ä¿¡æ¯](/docs/persistence)ã€‚

## åœ¨ä»»ä½•åœ°æ–¹å¼•ç”¨ actors

ç”±äº actors å¯ä»¥ç”Ÿæˆå…¶ä»– actorsï¼Œè€Œè¿™äº› actors åˆå¯ä»¥ç”Ÿæˆå…¶ä»– actorsï¼Œè¿™äº›è¿æ¥çš„ actors å½¢æˆäº†ä¸€ä¸ªè‡ªç„¶çš„å±‚æ¬¡ç»“æ„ï¼Œç§°ä¸ºâ€œactor ç³»ç»Ÿâ€ã€‚åœ¨ XState v4 ä¸­ï¼Œactors åªèƒ½é€šè¿‡ `sendTo('child-id', ...)` å’Œ `sendParent(...)` åœ¨çˆ¶å­å…³ç³»ä¸­è½»æ¾é€šä¿¡ã€‚ä»ä¸€ä¸ªä»»æ„ actor å‘åŒä¸€ç³»ç»Ÿä¸­çš„å¦ä¸€ä¸ªä»»æ„ actor å‘é€äº‹ä»¶æ˜¯å›°éš¾ä¸”è¿‡äºå¤æ‚çš„ã€‚

åœ¨ XState v5 ä¸­ï¼Œè°ƒç”¨ `createActor(...)` åˆ›å»ºä¸€ä¸ªæ ¹ actor ä¹Ÿå°†åˆ›å»ºä¸€ä¸ªéšå¼çš„ actor ç³»ç»Ÿã€‚è¿™å¯ç”¨äº†ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œç§°ä¸º **æ¥å¾…å‘˜æ¨¡å¼**ã€‚æ¥å¾…å‘˜æ¨¡å¼æ„å‘³ç€ actors å¯ä»¥é€šè¿‡å…¶ `systemId` æ³¨å†Œå’ŒæŸ¥æ‰¾ï¼Œè¿™å¯¹äºéœ€è¦ç›¸äº’é€šä¿¡ä½†å½¼æ­¤ä¸ç›´æ¥äº†è§£çš„ actorsï¼ˆå³ï¼Œä¸åœ¨çˆ¶å­å…³ç³»ä¸­çš„ actorsï¼‰éå¸¸æœ‰ç”¨ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ª `checkoutMachine` æ¥åè°ƒåœ¨çº¿å•†åº—çš„çŠ¶æ€ã€‚å¦‚æœæ‚¨å¸Œæœ›ä¸€ä¸ªé€šçŸ¥å™¨ actor åœ¨ `checkoutMachine` ç³»ç»Ÿå†…çš„ä»»ä½•ç”Ÿæˆçš„æœºå™¨ä¸­éƒ½å¯ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡æä¾› `systemId` æ¥æ³¨å†Œå®ƒï¼š

```ts
import { notifierMachine } from '../notifierMachine';
import { shippingMachine } from '../shippingMachine';

const checkoutMachine = createMachine({
  invoke: {
    src: notifierMachine,
    systemId: 'notifier',
  },
  // ...
  states: {
    // ...
    shipping: {
      invoke: {
        src: shippingMachine,
      },
    },
  },
});

const checkoutActor = createActor(checkoutMachine);
checkoutActor.start();
```

ç°åœ¨ï¼Œ`checkoutActor` ç³»ç»Ÿä¸­çš„ä»»ä½• actor éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨ `system.get("notifier")` è®¿é—®é€šçŸ¥å™¨ actorï¼š

```ts
const shippingMachine = createMachine({
  // ...
  on: {
    'address.updated': {
      actions: sendTo(({ system }) => system.get('notifier'), {
        type: 'notify',
        message: 'Shipping address updated',
      }),
    },
  },
});
```

éšå¼ç³»ç»Ÿå’Œæ¥å¾…å‘˜æ¨¡å¼ä½¿å¾—å»ºæ¨¡ä»»æ„ actor ä¹‹é—´çš„é€šä¿¡ã€äº‹ä»¶æ€»çº¿å’Œå…¶ä»–äº‹ä»¶é©±åŠ¨æ¨¡å¼å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä¸º actors æŒ‡å®šåˆå§‹â€œè¾“å…¥æ•°æ®â€ã€‚åœ¨ XState v4 ä¸­æä¾›è¿™äº›è¾“å…¥æ•°æ®å¹¶ä¸å®¹æ˜“ã€‚æ‚¨å¿…é¡»ï¼š

- åˆ›å»ºä¸€ä¸ªå·¥å‚æœºå™¨å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€äº›è¾“å…¥æ•°æ®å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¯¥è¾“å…¥æ•°æ®çš„æœºå™¨ã€‚
- ä½¿ç”¨ `machine.withContext(...)` åˆ›å»ºä¸€ä¸ªæ–°æœºå™¨ï¼Œå¹¶å°†æ•´ä¸ªä¸Šä¸‹æ–‡ä¸è¾“å…¥æ•°æ®ä¸€èµ·ä¼ é€’ã€‚

ç”±äºåªæœ‰æœºå™¨åº”è¯¥æœ€åˆç¡®å®š `context`ï¼Œè¿™å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå¯èƒ½ä¼šåœ¨æŸä¸ªä¸å¯èƒ½çš„çŠ¶æ€ä¸‹åˆå§‹åŒ–æœºå™¨ã€‚æ­¤å¤–ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†æŸäº› `context` å±æ€§è§†ä¸º _ç§æœ‰_ï¼ˆæœºå™¨å†…éƒ¨ï¼‰ä¸”ä¸å¯å¤–éƒ¨é…ç½®ã€‚

åœ¨ XState v5 ä¸­ï¼Œæ‚¨ç°åœ¨å¯ä»¥é€šè¿‡å°†è¾“å…¥æ•°æ®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ `createActor(machine, { input })` æ¥ä¸ºæœºå™¨æä¾›è¾“å…¥æ•°æ®ã€‚æœºå™¨å¯ä»¥åœ¨ `context` åˆå§‹åŒ–å‡½æ•°ä¸­è¯»å–è¿™äº›è¾“å…¥æ•°æ®ï¼š

```ts
const greetingMachine = createMachine({
  context: ({ input }) => ({
    greeting: `Hello, ${input.name}!`,
  }),
});

const greetingActor = createActor(greetingMachine, {
  input: {
    name: 'David',
  },
});
```

æ­¤å¤–ï¼Œè¿™é€‚ç”¨äºä»»ä½• actor é€»è¾‘ï¼Œè€Œä¸ä»…ä»…æ˜¯çŠ¶æ€æœºï¼š

```ts
const promiseLogic = fromPromise(({ input }) =>
  fetch(`https://api.example.com/users/${input.id}`).then((res) => res.json()),
);

// ç‹¬ç«‹çš„ promise actor
const promiseActor = createActor(promiseLogic, {
  input: {
    id: 42,
  },
});

// ä»ä¸€ä¸ªæœºå™¨
const machine = setup({
  actors: { promiseLogic }
}).createMachine({
  invoke: {
    src: 'promiseLogic',
    input: {
      id: 42,
    },
  }
})
```

actors è¿˜å¯ä»¥æœ‰ [output](/docs/output)ï¼Œå®ƒè¡¨ç¤ºå®ƒä»¬åˆ°è¾¾æœ€ç»ˆçŠ¶æ€æ—¶çš„â€œå®Œæˆæ•°æ®â€ã€‚ä¸ä»…ä»…æ˜¯çŠ¶æ€æœºå¯ä»¥æœ‰è¾“å‡ºï¼›promise é€»è¾‘è‡ªç„¶ä¼šäº§ç”Ÿè¾“å‡ºï¼Œå¹¶ä¸”å°†æ¥å¯èƒ½ä¸ºå…¶ä»– actor é€»è¾‘ç±»å‹æŒ‡å®šè¾“å‡ºã€‚

[é˜…è¯»æ›´å¤šå…³äº input çš„ä¿¡æ¯](/docs/input)ã€[output](/docs/output) å’Œ [context çš„ä¿¡æ¯](/docs/context)ã€‚

```ts
const processMachine = createMachine({
  id: 'some-process',
  initial: 'pending',
  context: {/* ... */},,
  states: {
    pending: {/* ... */},
    transforming: {/* ... */},
    done: {
      type: 'final'
    },
  },
  // highlight-start
  output: ({ context }) => ({
    status: 200,
    result: context.transformedData,
  })
  // highlight-end
});
```

## æ›´å¼ºçš„ç±»å‹æ¨æ–­

XState çš„ä¸€ä¸ªæœ€å¤§éœ€æ±‚æ˜¯æ”¹è¿› TypeScript ä½“éªŒã€‚è€ƒè™‘åˆ°çŠ¶æ€å›¾ï¼ˆåˆ†å±‚çŠ¶æ€æœºï¼‰çš„å¶ç„¶å¤æ‚æ€§ï¼Œä»¥åŠéœ€è¦ä»¥å£°æ˜æ–¹å¼è¡¨ç¤ºå®ƒä»¬ï¼Œä»¥ä¾¿å¯ä»¥å¯è§†åŒ–ã€é™æ€åˆ†æå’Œå¼ºç±»å‹åŒ–ï¼Œè¿™å¹¶éæ˜“äº‹ã€‚ä»»ä½•ä¸€ä¸ªè¿™äº›çº¦æŸéƒ½å·²ç»å¾ˆéš¾ï¼›æ‰€æœ‰ä¸‰ä¸ªçº¦æŸå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚

Mateusz BurzyÅ„ski æ‹¯æ•‘äº†æˆ‘ä»¬ï¼Œä»–ä¸ä»…åœ¨ XState ä¸­å±•ç¤ºäº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ TypeScript å·¥ç¨‹å’Œé­”æ³•ï¼Œè¿˜ç›´æ¥å¯¹ TypeScript æœ¬èº«åšå‡ºäº†é‡è¦è´¡çŒ®ï¼æ–°çš„ **setup API** æ˜¯ä¸€ä¸ªçœŸæ­£çªæ˜¾è¿™äº›æ”¹è¿›çš„é¢†åŸŸï¼š

```jsx
import { setup, fromPromise } from 'xstate';

const getChatCompletion = fromPromise(async () => { ... });
const processResult = fromPromise(async () => { ... });
const sendToDiscord = fromPromise(async () => { ... });

const machine = setup({
  actors: {
    getChatCompletion,
    processResult,
    sendToDiscord
  }
}).createMachine({
  // ...
  states: {
    thinking: {
      invoke: {
        // å­—ç¬¦ä¸²æºå¼ºç±»å‹ï¼
        src: 'getChatCompletion',
        onDone: {
          target: 'processing',
            actions: assign({
              // event.output å¼ºç±»å‹ï¼
              completion: ({ event }) => event.output
            })
        }
      }
    },
    processing: {
      invoke: { src: 'processResult', /** ... **/ }
    },
    sending: {
      invoke: { src: 'sendToDiscord', /** ... **/ }
    },
    done: { type: 'final' }
  }
});
```

ä½¿ç”¨ [`setup(...)`](/docs/machines#providing-implementations)ï¼Œæ‚¨ä¸å†éœ€è¦åšåŒé‡å·¥ä½œæ¥æŒ‡å®š actorsã€actionsã€guardsã€delays ç­‰çš„ç±»å‹ **å¹¶ä¸”** ä¹‹åå†æä¾›å®ƒä»¬ï¼›åªéœ€åœ¨ `setup(...)` å‡½æ•°ä¸­å®Œæˆè¿™äº›æ“ä½œï¼Œç±»å‹å°±ä¼šè‡ªåŠ¨æµåŠ¨ã€‚è¿™ä¹Ÿæ›´åŠ å®‰å…¨ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä¿è¯è¿™äº›å®ç°å­˜åœ¨ï¼Œè€Œä¸æ˜¯å¸Œæœ›å®ƒä»¬å­˜åœ¨ï¼ˆæˆ–ä¾èµ–äº typegenï¼‰åœ¨ä¹‹åæä¾›ã€‚

setup API è¿˜å¯ç”¨äº†å¦ä¸€ä¸ªç¥å¥‡çš„åŠŸèƒ½ï¼š**å¼ºç±»å‹çš„çŠ¶æ€å€¼** âœ¨

```ts
const machine = setup({
  // ...
}).createMachine({
  initial: 'green',
  states: {
    green: {/* ... */},
    yellow: {/* ... */},
    red: {
      initial: 'walk',
      states: {
        walk: {/* ... */},
        run: {/* ... */},
        stop: {/* ... */}
      }
    }
  }
});

const actor = createActor(machine)
actor.start();

// å¼ºç±»å‹çš„çŠ¶æ€å€¼ï¼
// è‡ªåŠ¨è¡¥å…¨å°†æ˜¾ç¤ºï¼š
// - 'green'
// - 'yellow'
// - 'red'
// - { red: 'walk' }
// - { red: 'run' }
// - { red: 'stop' }
actor.getSnapshot().matches('green');
```

[é˜…è¯»æ›´å¤šå…³äº `setup(...)` çš„ä¿¡æ¯](/docs/machines#providing-implementations)ã€‚

## åŠ¨æ€å‚æ•°

åœ¨ç±»å‹æ”¹è¿›çš„ä¸»é¢˜ä¸Šï¼ŒåŠ¨æ€ action å’Œ guard å‚æ•°ç°åœ¨ä½¿å¾—åˆ›å»ºç‹¬ç«‹äºçŠ¶æ€æœºçš„å¼ºç±»å‹ action å’Œ guard å®ç°æˆä¸ºå¯èƒ½ï¼š

```ts
const machine = setup({
  actions: {
    greet: (_, params: { name: string }) => {
      console.log(`Hello, ${params.name}!`);
    }
  },
  guards: {
    isGreaterThan: (_, params: { value: number; min: number }) => {
      return params.value > params.min;
    }
  }
}).createMachine({
  context: ({ input }) => ({
    user: input.user,
    count: 0
  }),
  entry: {
    type: 'greet',
    // highlight-start
    params: ({ context }) => ({
      name: context.user.name
    })
    // highlight-end
  },
  on: {
    dec: {
      guard: {
        type: 'isGreaterThan',
        // highlight-start
        params: ({ context, event }) => ({
          value: context.count,
          min: 0
        })
        // highlight-end
      }
    }
  }
});
```

è¿™æ¶ˆé™¤äº†åŠ¨ä½œå®ç°ä¸æœºå™¨çš„è€¦åˆï¼Œå¹¶å…è®¸æ›´çµæ´»åœ°ä½¿ç”¨å®ƒä»¬ã€‚å®ƒè¿˜å‡å°‘äº†å¯¹ç±»ä¼¼ typegen çš„ä¾èµ–ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦é¢„æµ‹åŠ¨ä½œå¯ä»¥è°ƒç”¨çš„å¯èƒ½ `context` æˆ– `event` ç±»å‹ã€‚

## æ’é˜ŸåŠ¨ä½œ

`enqueueActions()` åŠ¨ä½œåˆ›å»ºå™¨ä½¿å¾—åœ¨å•ä¸ªåŠ¨ä½œåˆ›å»ºå™¨ä¸­åè°ƒå¤æ‚åŠ¨ä½œå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯ä»¥å°†å…¶è§†ä¸º `pure()` å’Œ `choose()` çš„æ›´ç›´è§‚ç»„åˆï¼Œå®ƒä»¬ç°åœ¨è¢«è¿™ä¸ªæ–°çš„åŠ¨ä½œåˆ›å»ºå™¨æ‰€å–ä»£ï¼š

```ts
const machine = createMachine({
  // ...
  entry: enqueueActions(({ context, event, enqueue, check }) => {
    // èµ‹å€¼åŠ¨ä½œ
    enqueue.assign({
      count: context.count + 1
    });

    // æ¡ä»¶åŠ¨ä½œï¼ˆæ›¿ä»£ choose(...)ï¼‰
    if (event.someOption) {
      enqueue.sendTo('someActor', { type: 'blah', thing: context.thing });

      // å…¶ä»–åŠ¨ä½œ
      enqueue('namedAction');
      // å¸¦å‚æ•°
      enqueue({ type: 'greet', params: { message: 'hello' } });
    } else {
      // å†…è”
      enqueue(() => console.log('hello'));

      // ç”šè‡³å†…ç½®åŠ¨ä½œ
    }

    // ä½¿ç”¨ check(...) åŸºäºå®ˆå«æ¡ä»¶æ€§åœ°æ’é˜ŸåŠ¨ä½œ
    if (check({ type: 'someGuard' })) {
      // ...
    }

    // æ— è¿”å›å€¼
  })
});
```

è¿™æ˜¯ä¸€ä¸ªæ›´è‡ªç„¶çš„ç¼–å†™æ•ˆæœçš„æ–¹æ³•ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨æ™®é€šçš„ JavaScript æ¥æ„å»ºæ•ˆæœã€‚[åœ¨æˆ‘ä»¬çš„è¿ç§»æŒ‡å—ä¸­é˜…è¯»æ›´å¤šå…³äº `enqueueActions()` åŠ¨ä½œåˆ›å»ºå™¨çš„ä¿¡æ¯](/docs/migration)ã€‚

## è‡ªå¼•ç”¨

åœ¨æ‚¨å¯ä»¥åœ¨ XState v5 æœºå™¨é…ç½®ä¸­æä¾›çš„åŠ¨æ€å‡½æ•°ä¸­ï¼Œç°åœ¨æœ‰ä¸€ä¸ª `self` å±æ€§å¼•ç”¨ actor æœ¬èº«ã€‚è¿™ä¸º actor é€šä¿¡å¯ç”¨äº†æ–°çš„ã€çµæ´»çš„æ¨¡å¼ï¼Œå› ä¸ºæ‚¨å¯ä»¥åœ¨äº‹ä»¶ä¸­å°†æ­¤ `self` å¼•ç”¨ä¼ é€’ç»™å…¶ä»– actorsï¼š

```ts
const pingMachine = createMachine({
  invoke: {
    src: 'pong',
    id: 'pong',
  },
  on: {
    ping: {
      actions: sendTo('pong', ({ self }) => ({ type: 'ping', sender: self })),
    },
  },
});

// ...

const pongMachine = createMachine({
  on: {
    ping: {
      actions: sendTo(({ event }) => event.sender, { type: 'pong' }),
    },
  },
});
```

[é˜…è¯»æ›´å¤šå…³äº `self` å±æ€§çš„ä¿¡æ¯](/docs/migration)ã€‚

## é«˜é˜¶å®ˆå«

åœ¨ XState v4 ä¸­ï¼Œå®ˆå«æ˜¯ `.cond` è½¬æ¢å±æ€§ä¸Šçš„ç®€å•å‡½æ•°ï¼Œè¿”å› `true` æˆ– `false` ä»¥ç¡®å®šæ˜¯å¦é‡‡å–è½¬æ¢ã€‚è¦å¦å®šå®ˆå«æˆ–ç»„åˆå®ˆå«ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„å®ˆå«ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç é‡å¤æˆ–å†—ä½™ã€‚åœ¨ XState v5 ä¸­ï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ [é«˜é˜¶å®ˆå«](/docs/guards/#higher-level-guards)ï¼Œè¿™äº›æ˜¯æ¥å—å®ˆå«ï¼ˆå¼•ç”¨å’Œ/æˆ–å†…è”ï¼‰å¹¶è¿”å›å®ˆå«å‡½æ•°çš„å‡½æ•°ã€‚æœ‰ 3 ä¸ªå†…ç½®çš„é«˜é˜¶å®ˆå«å‡½æ•°ï¼š`and([...guards])`ã€`or([...guards])` å’Œ `not(guard)`ï¼š

```ts
import { setup, and, not } from 'xstate';

const userMachine = setup({
  guards: {
    isAuthenticated: ({ context }) => context.user !== undefined,
    isAdmin: ({ context }) => context.user.role === 'admin',
    isBanned: ({ context }) => context.user.status === 'banned',
  }
}).createMachine({
  // ...
  on: {
    doSomething: {
      // é«˜é˜¶å®ˆå«
      // ä» "cond" (v4) é‡å‘½åä¸º "guard" (v5)
      guard: and(['isAuthenticated', 'isAdmin', not('isBanned')]),
    },
  },
});
```

è¿™äº›é«˜é˜¶å®ˆå«å¯ä»¥ä»¥å¤šç§ä¸åŒçš„æ–¹å¼ç»„åˆï¼Œä»¥è¡¨è¾¾ä»»ä½•å¤æ‚çš„æ¡ä»¶ã€‚æœªæ¥ï¼Œ[Stately Studio](/docs/studio) å°†èƒ½å¤Ÿå¯è§†åŒ–å®ˆå«ä¸­è¡¨è¾¾çš„å¤æ‚æ¡ä»¶é€»è¾‘ã€‚[åœ¨æˆ‘ä»¬çš„æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šå…³äºé«˜é˜¶å®ˆå«çš„ä¿¡æ¯](/docs/guards/#higher-level-guards)ã€‚

## éƒ¨åˆ†äº‹ä»¶æè¿°ç¬¦

éƒ¨åˆ†äº‹ä»¶æè¿°ç¬¦ï¼Œä¹Ÿç§°ä¸º _éƒ¨åˆ†é€šé…ç¬¦_ï¼Œæ˜¯ XState v5 ä¸­çš„ä¸€ä¸ªå¼ºå¤§æ–°åŠŸèƒ½ï¼Œä½¿å¤„ç†äº‹ä»¶ç»„å˜å¾—æ›´åŠ å®¹æ˜“ã€‚åœ¨ XState v4 ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥å¤„ç†ä»»ä½•æœªè¢«å…¶ä»–è½¬æ¢åŒ¹é…çš„äº‹ä»¶ï¼Œä½†æ‚¨å¿…é¡»å°å¿ƒä¸è¦æ„å¤–å¤„ç†ä¸æ‰“ç®—å¤„ç†çš„äº‹ä»¶ã€‚åœ¨ XState v5 ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨éƒ¨åˆ†äº‹ä»¶æè¿°ç¬¦é€šè¿‡åœ¨åˆ†éš”ç¬¦åæ”¾ç½®é€šé…ç¬¦ (`.*`) æ¥å¤„ç†äº‹ä»¶ç»„ï¼Œå¹¶ä¸”å¯ä»¥æ˜ç¡®æ‚¨æƒ³è¦å¤„ç†çš„äº‹ä»¶ï¼š

```ts
const machine = createMachine({
  // ...
  on: {
    // å°†å¤„ç†ä»»ä½•ä»¥ "pointer." å¼€å¤´çš„äº‹ä»¶ï¼š
    // "pointer.down", "pointer.up", "pointer.move" ç­‰ç­‰ã€‚
    'pointer.*': {
      actions: 'logPointerEvent',
    },
  },
});
```

[åœ¨æˆ‘ä»¬çš„æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šå…³äºéƒ¨åˆ†äº‹ä»¶æè¿°ç¬¦çš„ä¿¡æ¯](/docs/transitions#partial-wildcard-transitions)ã€‚

å“¦ï¼Œé¡ºä¾¿è¯´ä¸€å¥ï¼Œå®ƒä»¬æ˜¯ç±»å‹å®‰å…¨çš„ï¼ğŸ‰

## è¿ç§»å’Œé‡å¤§å˜åŒ–

ä¸ä»»ä½•ä¸»è¦ç‰ˆæœ¬ä¸€æ ·ï¼Œæœ‰ä¸€äº›é‡å¤§å˜åŒ–ã€‚æˆ‘ä»¬å°½é‡å°†è¿™äº›å˜åŒ–ä¿æŒåœ¨æœ€ä½é™åº¦ï¼Œä½†æœ‰äº›æ˜¯å¿…è¦çš„ï¼Œä»¥ä½¿ XState v5 å°½å¯èƒ½å¼ºå¤§ã€çµæ´»ã€ç®€å•å’Œå¼ºç±»å‹åŒ–ã€‚[é˜…è¯»æˆ‘ä»¬çš„æŒ‡å—ï¼Œäº†è§£ä» XState v4 è¿ç§»åˆ° v5 çš„æ–¹æ³•ä»¥åŠé‡å¤§å˜åŒ–çš„åˆ—è¡¨](https://stately.ai/docs/migration)ã€‚

æœ€å¤§çš„å˜åŒ–ä¹‹ä¸€æ˜¯å°†å‡½æ•°å‚æ•°åˆå¹¶ä¸ºå•ä¸ªâ€œç»Ÿä¸€å‚æ•°â€ã€‚å®ç°å‡½æ•°ä»¥å‰éœ€è¦å¤šä¸ªå‚æ•°ï¼Œè¿™ä½¿å¾—è®°ä½ä½¿ç”¨å“ªä¸ªå‚æ•°æˆ–å¿½ç•¥æŸäº›å‚æ•°å˜å¾—å›°éš¾ã€‚åœ¨ XState v5 ä¸­ï¼Œæ‰€æœ‰å®ç°å‡½æ•°ç°åœ¨éƒ½æ¥å—ä¸€ä¸ªå•ä¸€çš„ç»Ÿä¸€å‚æ•°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å« `context`ã€`event` å’Œå…¶ä»–ä¸å®ç°å‡½æ•°ç›¸å…³çš„å±æ€§ï¼š

```ts
const machine = createMachine({
  context: {
    count: 0,
  },
  on: {
    increment: {
      // highlight-start
      // å•ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ï¼š
      // guard: (_, event) => ...
      guard: ({ event }) => !Number.isNaN(event.value),
      // å•ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ï¼š
      // actions: (context, event) => ...
      actions: ({ context, event }) => {
        console.log(context, event);
      },
      // highlight-end
    },
  },
});
```

## Stately Studio å¯¹ v5 çš„æ”¯æŒ

ç°åœ¨ XState v5 API ç»ˆäºç¨³å®šäº†ï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›åœ¨ [Stately Studio](https://stately.ai/editor) ä¸­æ·»åŠ å¯¹æ‰€æœ‰æ–°åŠŸèƒ½å’Œæ›´æ–°çš„æ”¯æŒã€‚ç›®å‰ï¼ŒStudio å·²ç»å¯ä»¥å¯¼å…¥å’Œå¯¼å‡º XState v5 ä»£ç ã€‚å³å°†æ¨å‡ºçš„æ˜¯å¯¹ `input`ã€`output` å’Œ action/guard å‚æ•°çš„æ”¯æŒã€‚ä¸ºäº†ç»™æ‚¨å®Œå…¨çš„æ§åˆ¶æƒï¼Œæˆ‘ä»¬è¿˜å³å°†å‘å¸ƒç”¨äº actionsã€actorsã€guards ç­‰çš„ Studio å†…ä»£ç ç¼–è¾‘å™¨ã€‚é€šè¿‡ Stately AIï¼Œæ‚¨ç”šè‡³å¯ä»¥ç”Ÿæˆä»»ä½•æ‚¨æƒ³è¦å®ç°çš„ä»£ç ï¼Œå®Œå…¨ç¬¦åˆ XState v5 ä»£ç ã€‚

ä¸ºäº†åº†ç¥ XState v5 çš„å‘å¸ƒï¼Œä½¿ç”¨ä»£ç  `XSTATEV5` å¯äº«å— [Stately Pro è®¢é˜…](https://stately.ai/pricing) 35% çš„æŠ˜æ‰£ï¼Œå¹¶è§£é” Stately Studio ä¸­çš„ä¼—å¤šç²¾å½©ä¸“ä¸šåŠŸèƒ½ã€‚

## æœªæ¥è®¡åˆ’å’Œæƒ³æ³•

è¿™ä¸æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆçŠ¶æ€ã€‚XState v5 è¿˜æœ‰æ›´å¤šçš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚ï¼š

- [ä¸€ä¸ª `toPromise()` è¾…åŠ©å‡½æ•°](https://github.com/statelyai/xstate/pull/4198)ï¼Œç”¨äºå°† actors è½¬æ¢ä¸ºå¯ç­‰å¾…çš„ promises
- [åŸºäºæ­¥éª¤çš„å¼‚æ­¥é€»è¾‘](https://github.com/statelyai/xstate/pull/4190)ï¼Œç”¨äºåœ¨ promise actors ä¸­å»ºæ¨¡æ­¥éª¤
- [å¯è·¯ç”±çŠ¶æ€](https://github.com/statelyai/xstate/pull/4184)ï¼Œç”¨äºåœ¨ä»»ä½•æ—¶å€™æ˜¾å¼å»ºæ¨¡ç›´æ¥è½¬æ¢åˆ°ç‰¹å®šçŠ¶æ€ï¼ˆå¯¹è·¯ç”±å¾ˆæœ‰ç”¨ï¼‰
- Typestatesï¼Œç”¨äºåœ¨ç‰¹å®šçŠ¶æ€ä¸‹çº¦æŸ `context` ç±»å‹
