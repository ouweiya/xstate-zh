---
title: Systems(ç³»ç»Ÿ)
---

æ¼”å‘˜ç³»ç»Ÿæ˜¯å¯ä»¥ç›¸äº’é€šä¿¡çš„æ¼”å‘˜é›†åˆã€‚æ¼”å‘˜å¯ä»¥è°ƒç”¨/ç”Ÿæˆå…¶ä»–æ¼”å‘˜ï¼Œä»Žè€Œå½¢æˆå±žäºŽåŒä¸€ç³»ç»Ÿçš„è‡ªç„¶å±‚æ¬¡ç»“æž„ã€‚

åœ¨ XState ä¸­ï¼Œç³»ç»Ÿæ˜¯ä»Žæ ¹æ¼”å‘˜éšå¼åˆ›å»ºçš„ï¼Œå³ä»Ž `createActor(machine).start()` è¿”å›žçš„æ¼”å‘˜ã€‚ç³»ç»Ÿå¯ä»¥ä»Žæ¼”å‘˜çš„ `actor.system` å±žæ€§ä»¥åŠä»ŽçŠ¶æ€æœºåŠ¨ä½œä¸­è§£æž„çš„ `{ system }` å±žæ€§è®¿é—®ï¼š

```ts
import { createMachine, createActor } from 'xstate';

const machine = createMachine({
  // highlight-next-line
  entry: ({ system }) => {
    // ...
  },
});

const actor = createActor(machine).start();
// highlight-next-line
actor.system;
```

ç³»ç»Ÿçš„æ ¹ä¹Ÿå¯ä»¥åœ¨ `createActor(...)` å‡½æ•°ä¸­æ˜¾å¼åˆ†é…ä¸€ä¸ª `systemId`ï¼š

```ts
import { createActor } from 'xstate';

const actor = createActor(machine, {
  systemId: 'root-id',
});

actor.start();
```

è¿™å¯¹äºŽç³»ç»Ÿä¸­çš„æ¼”å‘˜èƒ½å¤Ÿå‘æ ¹æ¼”å‘˜å‘é€äº‹ä»¶éžå¸¸æœ‰ç”¨ã€‚

:::studio

å³å°†æŽ¨å‡ºâ€¦ Stately Studio ç¼–è¾‘å™¨ä¸­çš„ç³»ç»Ÿ ðŸ¤«

:::

## æ¼”å‘˜æ³¨å†Œ

æ¼”å‘˜å¯ä»¥æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼Œä»¥ä¾¿ç³»ç»Ÿä¸­çš„ä»»ä½•å…¶ä»–æ¼”å‘˜éƒ½å¯ä»¥èŽ·å–å…¶å¼•ç”¨ã€‚

è¢«è°ƒç”¨çš„æ¼”å‘˜åœ¨ `invoke` å¯¹è±¡ä¸­ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„ `systemId` æ³¨å†Œï¼š

```ts
import { createMachine, createActor, sendTo } from 'xstate';

const formMachine = createMachine({
  // ...
  on: {
    submit: {
      // highlight-next-line
      actions: sendTo(({ system }) => system.get('notifier'), {
        type: 'notify',
        message: 'Form submitted!',
      }),
    },
  },
});

const feedbackMachine = createMachine({
  invoke: {
    // highlight-next-line
    systemId: 'formMachine',
    src: formMachine,
  },
  // ...
  states: {
    // ...
    form: {
      invoke: formMachine,
    },
  },
});

const feedbackActor = createActor(feedbackMachine).start();
```

ç”Ÿæˆçš„æ¼”å‘˜åœ¨ `spawn` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„ `systemId` æ³¨å†Œï¼š

```ts
import { createMachine, createActor, assign } from 'xstate';

const todoMachine = createMachine({
  // ...
});

const todosMachine = createMachine({
  // ...
  on: {
    'todo.add': {
      actions: assign({
        todos: ({ context, spawn }) => {
          const newTodo = spawn(todoMachine, {
            // highlight-next-line
            systemId: `todo-${context.todos.length}`,
          });

          return context.todos.concat(newTodo);
        },
      }),
    },
  },
});
```

## æ¼”å‘˜é€šä¿¡

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ `system.get('actorId')` ä»Žç³»ç»Ÿä¸­å¼•ç”¨ç‰¹å®šæ¼”å‘˜ï¼š

## åœæ­¢ç³»ç»Ÿ

- ä»Žæ ¹æ¼”å‘˜åœæ­¢ï¼š`actor.stop()`
- æ— æ³•ä»Žå­æ¼”å‘˜åœæ­¢
  - å°†è®°å½•è­¦å‘Š

## ç³»ç»Ÿå’Œ TypeScript

:::typescript

**XState v5 éœ€è¦ TypeScript ç‰ˆæœ¬ 5.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚**

ä¸ºäº†èŽ·å¾—æœ€ä½³æ•ˆæžœï¼Œè¯·ä½¿ç”¨æœ€æ–°çš„ TypeScript ç‰ˆæœ¬ã€‚[é˜…è¯»æ›´å¤šå…³äºŽ XState å’Œ TypeScript çš„ä¿¡æ¯](typescript.mdx)

:::

- `invoke.systemId`
- `spawn(thing, { systemId })`
- `system.get('actorId')`
- `rootActor.stop()`

## ç³»ç»Ÿå¤‡å¿˜å•

### å¤‡å¿˜å•ï¼šæ¼”å‘˜ç³»ç»Ÿ

```ts
import { createMachine, createActor } from 'xstate';

const machine = createMachine({
  // highlight-next-line
  entry: ({ system }) => {
    // ...
  },
});

const actor = createActor(machine).start();
// highlight-next-line
actor.system;
```

### å¤‡å¿˜å•ï¼šæ˜¾å¼åˆ†é… `systemId`

```ts
import { createActor } from 'xstate';

const actor = createActor(machine, {
  // highlight-next-line
  systemId: 'root-id',
});

actor.start();
```

### å¤‡å¿˜å•ï¼šä½¿ç”¨ç³»ç»Ÿæ³¨å†Œè¢«è°ƒç”¨çš„æ¼”å‘˜

```ts
import { createMachine, createActor, sendTo } from 'xstate';

const formMachine = createMachine({
  // ...
  on: {
    submit: {
      // highlight-next-line
      actions: sendTo(({ system }) => system.get('notifier'), {
        type: 'notify',
        message: 'Form submitted!',
      }),
    },
  },
});

const feedbackMachine = createMachine({
  invoke: {
    // highlight-next-line
    systemId: 'formMachine',
    src: formMachine,
  },
  // ...
  states: {
    // ...
    form: {
      invoke: formMachine,
    },
  },
});

const feedbackActor = createActor(feedbackMachine).start();
```

### å¤‡å¿˜å•ï¼šä½¿ç”¨ç³»ç»Ÿæ³¨å†Œç”Ÿæˆçš„æ¼”å‘˜

```ts
import { createMachine, createActor, assign } from 'xstate';

const todoMachine = createMachine({
  // ...
});

const todosMachine = createMachine({
  // ...
  on: {
    'todo.add': {
      actions: assign({
        todos: ({ context, spawn }) => {
          const newTodo = spawn(todoMachine, {
            // highlight-next-line
            systemId: `todo-${context.todos.length}`,
          });

          return context.todos.concat(newTodo);
        },
      }),
    },
  },
});
```
