"use strict";(self.webpackChunkstately_docs=self.webpackChunkstately_docs||[]).push([[9015],{93843:(r,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>m,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var o=s(85893),n=s(11151);const t={title:"Promise actors"},i=void 0,c={id:"promise-actors",title:"Promise actors",description:"Promise actors \u662f\u8868\u793a\u6267\u884c\u67d0\u4e9b\u5f02\u6b65\u4efb\u52a1\u7684 promise \u7684 actors\u3002\u5b83\u4eec\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e00\u4e9b\u8f93\u51fa\uff0c\u6216\u8005\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002",source:"@site/docs/promise-actors.mdx",sourceDirName:".",slug:"/promise-actors",permalink:"/xstate-zh/docs/promise-actors",draft:!1,unlisted:!1,editUrl:"https://github.com/statelyai/docs/tree/main/docs/promise-actors.mdx",tags:[],version:"current",frontMatter:{title:"Promise actors"},sidebar:"tutorialSidebar",previous:{title:"\u72b6\u6001\u673a\u6f14\u5458",permalink:"/xstate-zh/docs/state-machine-actors"},next:{title:"\u8f6c\u6362\u6f14\u5458",permalink:"/xstate-zh/docs/transition-actors"}},a={},d=[{value:"Promise actor \u529f\u80fd",id:"promise-actor-\u529f\u80fd",level:2},{value:"Promise actor \u903b\u8f91",id:"promise-actor-\u903b\u8f91",level:2},{value:"Promise actor \u8f93\u5165",id:"promise-actor-\u8f93\u5165",level:2},{value:"Promise actor \u8f93\u51fa",id:"promise-actor-\u8f93\u51fa",level:2},{value:"Promise actor \u9519\u8bef\u5904\u7406",id:"promise-actor-\u9519\u8bef\u5904\u7406",level:2},{value:"\u505c\u6b62 promise actors",id:"\u505c\u6b62-promise-actors",level:2}];function l(r){const e={code:"code",h2:"h2",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.a)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"Promise actors \u662f\u8868\u793a\u6267\u884c\u67d0\u4e9b\u5f02\u6b65\u4efb\u52a1\u7684 promise \u7684 actors\u3002\u5b83\u4eec\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e00\u4e9b\u8f93\u51fa\uff0c\u6216\u8005\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002"}),"\n",(0,o.jsx)(e.h2,{id:"promise-actor-\u529f\u80fd",children:"Promise actor \u529f\u80fd"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{}),(0,o.jsx)(e.th,{children:"\u529f\u80fd"}),(0,o.jsx)(e.th,{children:"\u5907\u6ce8"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.span,{role:"img","aria-label":"cross mark",children:"\u274c"})}),(0,o.jsx)(e.td,{children:"\u63a5\u6536\u4e8b\u4ef6"}),(0,o.jsx)(e.td,{children:"Promise actors \u76ee\u524d\u4e0d\u63a5\u6536\u4e8b\u4ef6\u3002"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.span,{role:"img","aria-label":"check mark button",children:"\u2705"})}),(0,o.jsx)(e.td,{children:"\u53d1\u9001\u4e8b\u4ef6"}),(0,o.jsxs)(e.td,{children:["Promise actors \u53ef\u4ee5\u5411\u5b83\u5f15\u7528\u7684\u5176\u4ed6 actors \u53d1\u9001\u4e8b\u4ef6\uff0c\u4f8b\u5982\u5728\u5176 ",(0,o.jsx)(e.code,{children:"input"})," \u4e2d\u63d0\u4f9b\u7684\u90a3\u4e9b\u3002"]})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.span,{role:"img","aria-label":"cross mark",children:"\u274c"})}),(0,o.jsx)(e.td,{children:"\u751f\u6210 actors"}),(0,o.jsx)(e.td,{children:"Promise actors \u76ee\u524d\u4e0d\u80fd\u751f\u6210\u65b0\u7684 actors\u3002"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.span,{role:"img","aria-label":"check mark button",children:"\u2705"})}),(0,o.jsx)(e.td,{children:"\u8f93\u5165"}),(0,o.jsxs)(e.td,{children:["\u4f60\u53ef\u4ee5\u5411 promise actors \u63d0\u4f9b ",(0,o.jsx)(e.code,{children:"input"}),"\u3002"]})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.span,{role:"img","aria-label":"check mark button",children:"\u2705"})}),(0,o.jsx)(e.td,{children:"\u8f93\u51fa"}),(0,o.jsxs)(e.td,{children:["Promise actors \u53ef\u4ee5\u751f\u6210 ",(0,o.jsx)(e.code,{children:"output"}),"\uff0c\u5373 promise \u7684\u8fd4\u56de\u503c\u3002"]})]})]})]}),"\n",(0,o.jsx)(e.h2,{id:"promise-actor-\u903b\u8f91",children:"Promise actor \u903b\u8f91"}),"\n",(0,o.jsxs)(e.p,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(e.code,{children:"fromPromise(...)"})," actor \u903b\u8f91\u521b\u5efa\u5668\u5b9a\u4e49 promise actor \u903b\u8f91\uff0c\u8be5\u521b\u5efa\u5668\u63a5\u53d7\u4e00\u4e2a\u8fd4\u56de promise \u7684\u51fd\u6570\uff0c\u5e76\u8fd4\u56de\u53ef\u7528\u4e8e\u521b\u5efa promise actors \u7684 actor \u903b\u8f91\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise, createActor } from 'xstate';\n\nasync function getUser(id: string) {\n  // ...\n  return { id, /* other user data */ };\n}\n\n// highlight-start\nconst promiseLogic = fromPromise(async () => {\n  const user = await getUser('123');\n\n  return user;\n});\n// highlight-end\n\nconst promiseActor = createActor(promiseLogic);\n\npromiseActor.subscribe(snapshot => {\n  console.log(snapshot.status, snapshot.output);\n});\n\npromiseActor.start();\n\n// \u8bb0\u5f55 'active', undefined\n// ... (\u8fc7\u4e00\u6bb5\u65f6\u95f4)\n// \u8bb0\u5f55 'done', { id: '123', /* \u5176\u4ed6\u7528\u6237\u6570\u636e */ }\n"})}),"\n",(0,o.jsx)(e.h2,{id:"promise-actor-\u8f93\u5165",children:"Promise actor \u8f93\u5165"}),"\n",(0,o.jsxs)(e.p,{children:["\u4f60\u53ef\u4ee5\u901a\u8fc7\u5c06 ",(0,o.jsx)(e.code,{children:"input"})," \u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684 ",(0,o.jsx)(e.code,{children:"input"})," \u5c5e\u6027\u4f20\u9012\u7ed9 ",(0,o.jsx)(e.code,{children:"createActor(...)"})," \u51fd\u6570\u6765\u4f20\u9012 ",(0,o.jsx)(e.code,{children:"input"})," \u7ed9 promise actor\u3002\u5728 promise \u903b\u8f91 (",(0,o.jsx)(e.code,{children:"fromPromise(promiseFn)"}),") \u4e2d\uff0c\u4f60\u53ef\u4ee5\u8bfb\u53d6\u4f20\u9012\u7ed9 promise \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684 ",(0,o.jsx)(e.code,{children:"input"})," \u5c5e\u6027\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise, createActor } from 'xstate';\n\nconst promiseLogic = fromPromise(async ({ input }) => {\n  const user = await getUser(input.id);\n\n  return user;\n});\n\nconst promiseActor = createActor(promiseLogic, {\n  // highlight-next-line\n  input: { id: '123' }\n});\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"input"})," \u7c7b\u578b\u662f\u4ece promise \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u7c7b\u578b\u63a8\u65ad\u51fa\u6765\u7684\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728\u7b2c\u4e8c\u4e2a\u6cdb\u578b\u53c2\u6570\u4e2d\u63d0\u4f9b\u663e\u5f0f\u7684 ",(0,o.jsx)(e.code,{children:"input"})," \u7c7b\u578b\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise } from 'xstate';\n\ninterface User {\n  name: string;\n  id: string;\n}\n\nconst secondLogic = fromPromise(async ({ input }: { input: { id: string }}) => {\n  const user = await getUser(input.id); // User is inferred\n\n  return user;\n});\n\nconst firstLogic = fromPromise<User, { id: string }>(async ({ input, self, /* ... */ }) => {\n  const user = await getUser(input.id);\n\n  return user;\n});\n"})}),"\n",(0,o.jsx)(e.h2,{id:"promise-actor-\u8f93\u51fa",children:"Promise actor \u8f93\u51fa"}),"\n",(0,o.jsxs)(e.p,{children:["\u8981\u83b7\u53d6 promise actor \u6700\u7ec8\u89e3\u6790\u7684 ",(0,o.jsx)(e.code,{children:"output"}),"\uff0c\u4f60\u53ef\u4ee5\u8ba2\u9605 promise actor \u5e76\u68c0\u67e5\u5feb\u7167\u7684 ",(0,o.jsx)(e.code,{children:"status"})," \u5c5e\u6027\u3002\u5982\u679c ",(0,o.jsx)(e.code,{children:"status"})," \u662f ",(0,o.jsx)(e.code,{children:"'done'"}),"\uff0c\u4f60\u53ef\u4ee5\u8bbf\u95ee\u5feb\u7167\u7684 ",(0,o.jsx)(e.code,{children:"output"})," \u5c5e\u6027\u4ee5\u83b7\u53d6\u89e3\u6790\u503c\u3002\u5426\u5219\uff0c",(0,o.jsx)(e.code,{children:"output"})," \u5c06\u662f ",(0,o.jsx)(e.code,{children:"undefined"}),"\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise } from 'xstate';\n\nconst promiseLogic = fromPromise(async () => {\n  const user = await getUser('123');\n\n  return user;\n});\n\nconst promiseActor = createActor(promiseLogic);\n\npromiseActor.subscribe(snapshot => {\n  if (snapshot.status === 'done') {\n    console.log(snapshot.output);\n    // \u8bb0\u5f55 { id: '123', /* \u5176\u4ed6\u7528\u6237\u6570\u636e */ }\n  }\n});\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(e.code,{children:"toPromise(...)"})," \u5c06\u4efb\u4f55 actor\uff08\u5305\u62ec promise actors\uff09\u8f6c\u6362\u4e3a promise\u3002\u5982\u679c\u4f60\u60f3 ",(0,o.jsx)(e.code,{children:"await"})," actor \u7684 ",(0,o.jsx)(e.code,{children:"output"}),"\uff0c\u8fd9\u5c06\u975e\u5e38\u6709\u7528\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { toPromise, createActor } from 'xstate';\nimport { somePromiseLogic } from './somePromiseLogic';\n\nconst promiseActor = createActor(somePromiseLogic);\npromiseActor.start();\n\n// highlight-next-line\nconst output = await toPromise(promiseActor);\n\nconsole.log(output);\n// \u8bb0\u5f55 promise actor \u89e3\u6790\u7684\u8f93\u51fa\n"})}),"\n",(0,o.jsx)(e.h2,{id:"promise-actor-\u9519\u8bef\u5904\u7406",children:"Promise actor \u9519\u8bef\u5904\u7406"}),"\n",(0,o.jsxs)(e.p,{children:["\u5982\u679c promise \u903b\u8f91\u4e2d\u53d1\u751f\u9519\u8bef\uff0cpromise actor \u5c06\u4f1a\u4ee5\u8be5\u9519\u8bef\u62d2\u7edd\u3002\u4f60\u53ef\u4ee5\u8ba2\u9605 promise actor\uff0c\u5e76\u5728",(0,o.jsx)(e.strong,{children:"\u9519\u8bef\u89c2\u5bdf\u8005"}),"\uff08\u89c2\u5bdf\u8005\u5bf9\u8c61\u7684 ",(0,o.jsx)(e.code,{children:"error"})," \u5c5e\u6027\uff09\u4e2d\u68c0\u67e5\u5feb\u7167\u7684 ",(0,o.jsx)(e.code,{children:"status"})," \u5c5e\u6027\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise } from 'xstate';\n\nconst promiseLogic = fromPromise(async () => {\n  // ...\n  throw new Error('Something went wrong');\n});\n\nconst promiseActor = createActor(promiseLogic);\npromiseActor.subscribe({\n  // highlight-start\n  error: (error) => {\n    console.error(error);\n    // logs 'Error: Something went wrong'\n  }\n    // highlight-end\n});\n\npromiseActor.start();\n"})}),"\n",(0,o.jsx)(e.h2,{id:"\u505c\u6b62-promise-actors",children:"\u505c\u6b62 promise actors"}),"\n",(0,o.jsxs)(e.p,{children:["\u4f60\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 actor \u5b9e\u4f8b\u7684 ",(0,o.jsx)(e.code,{children:".stop()"})," \u65b9\u6cd5\u6765\u505c\u6b62\u4f7f\u7528 ",(0,o.jsx)(e.code,{children:"createActor(promiseLogic)"})," \u521b\u5efa\u7684 promise actor\u3002\u8fd9\u5c06\u4e22\u5f03 promise \u7684\u89e3\u6790\u6216\u62d2\u7edd\u503c\uff0c\u5e76\u5904\u7406\u5bf9 promise actor \u7684\u4efb\u4f55\u8ba2\u9605\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5411\u5176\u4f20\u9012 ",(0,o.jsx)(e.code,{children:"signal"})," \u6765",(0,o.jsx)(e.strong,{children:"\u4e2d\u6b62"})," promise actor\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { fromPromise, createActor } from 'xstate';\n\nconst promiseLogic = fromPromise(async ({\n  input,\n  // highlight-next-line\n  signal\n}) => {\n  // highlight-start\n  // \u5982\u679c\u6536\u5230\u4fe1\u53f7\u5219\u4f20\u9012 signal \u4ee5\u4e2d\u6b62\u83b7\u53d6\n  const data = await fetch('/some/url', { signal });\n  // highlight-end\n\n  return data;\n});\n\nconst promiseActor = createActor(promiseLogic);\npromiseActor.start();\n\n// ...\n\n// highlight-start\n// \u4e2d\u6b62 promise actor\npromiseActor.stop();\n// highlight-end\n"})})]})}function m(r={}){const{wrapper:e}={...(0,n.a)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(l,{...r})}):l(r)}},11151:(r,e,s)=>{s.d(e,{Z:()=>c,a:()=>i});var o=s(67294);const n={},t=o.createContext(n);function i(r){const e=o.useContext(t);return o.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function c(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(n):r.components||n:i(r.components),o.createElement(t.Provider,{value:e},r.children)}}}]);